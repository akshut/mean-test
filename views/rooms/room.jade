extends ../layout

block content
  #checkin-bg

  #video.pull-right
    #checkin
      #checkin-text
        h4 Welcome! {Dr. Someone} will be with you shortly
        p Please check in and let the doctor know you are here:
      #previewtext
        p webcam preview
      input.name(type="text", placeholder="Enter your name here...")
      button.sendName Check In
      #mirror
    .chat.open

  #theirPublisherDiv

  #promptArrow
    span.promptContainer
      span.triangle
      span.box
    p Hit "Allow" to continue.

  #dash-button
      #nav-arrow.nav-arrow-open
  .nav-help.col-lg-2.tk-freight-sans-pro.nav-open
    .logotab
          a(href='/')
            img(src='/img/doxyme-logo-blk.png', height='40', alt='Doxy.me')
    ul
      li
        a.nav-help(href='mailto:recipient@example.com?Subject=Doxy.me%20meeting%20invitation&Body=Hi%20there!%0D%0DYou\'ve%20been%20invited%20to%20a%20Doxy.me%20meeting!%0D%0DGo%20to%20https://origin/drclark room%0D%0DWe%20hope%20you%20have%20a%20wonderful%20experience%20using%20Doxy.me.%20If%20you%20get%20a%20chance,%20please%20let%20us%20know%20how%20it%20worked%20for%20you:%20http://tiny.cc/0g5iyw', target='_blank')
          | Email this link
          i.glyphicon.glyphicon-envelope
      li
        a.nav-help(href='http://tokbox.com/user-diagnostic/', target='_blank')
          | Diagnostic Tool
          i.glyphicon.glyphicon-wrench
      li
        a#toggle.nav-help(href='#', onclick='return false')
          | Fullscreen
          i.glyphicon.glyphicon-fullscreen
      // li
      //   a.nav-help(href='/quick/meeting')
      //     | Quick Meeting
      //     i.iconHidden &#128101;
      // li
      //   a.nav-help(href='/#/about')
      //     | About
      //     i.iconHidden &#59170;

  script(src='/js/room.js')
  script.
    callDoctor(
      "!{sessionId}"
    , "!{token}"
    , "!{API_KEY}"
    , 'mirror'
    , 'theirPublisherDiv'
    , function(sendAvatar, sendName, session) {

      $('input.name').keyup(function(e) {
        if(e.which === 13)
          sendStuff()
      })
      sendStuff = function() {
        sendName($('input.name').val());
        sendAvatar();
      }
      $('button.sendName').click(function() {
        sendName($('input.name').val());
        sendAvatar();
      })


      var chatTemplate = templatizer.public.chat.chat('patient', session)
      
      $('.chat').html(chatTemplate)

    })

    new EventSource('/session/!{_id}')

    $("#nav-arrow").on('click', function() {
      $(".nav-help").toggleClass("nav-closed nav-open");
      $("#nav-arrow").toggleClass("nav-arrow-closed");
    });
